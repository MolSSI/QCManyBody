
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://molssi.github.io/QCManyBody/api/">
      
      
        <link rel="prev" href="../how-to-guides/">
      
      
      
      <link rel="icon" href="../logo.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.22">
    
    
      
        <title>API Documentation - QCManyBody Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.732c4fb1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#qcmanybody.ManyBodyCalculator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="QCManyBody Documentation" class="md-header__button md-logo" aria-label="QCManyBody Documentation" data-md-component="logo">
      
  <img src="../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            QCManyBody Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Documentation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/MolSSI/QCManyBody" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    MolSSI/QCManyBody
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../high-level-interface/" class="md-tabs__link">
        
  
    
  
  High-Level Interface

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../core-interface/" class="md-tabs__link">
        
  
    
  
  Core Interface

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../qcschema/" class="md-tabs__link">
        
  
    
  
  QCSchema

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../how-to-guides/" class="md-tabs__link">
        
  
    
  
  How-To Guides

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  API Documentation

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="QCManyBody Documentation" class="md-nav__button md-logo" aria-label="QCManyBody Documentation" data-md-component="logo">
      
  <img src="../logo.png" alt="logo">

    </a>
    QCManyBody Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/MolSSI/QCManyBody" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    MolSSI/QCManyBody
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../high-level-interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    High-Level Interface
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Interface
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../qcschema/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    QCSchema
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-guides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How-To Guides
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API Documentation
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API Documentation
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#qcmanybody.ManyBodyCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      ManyBodyCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qcmanybody.ManyBodyCalculator.format_calc_plan" class="md-nav__link">
    <span class="md-ellipsis">
      format_calc_plan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qcmanybody.ManyBodyCalculator.iterate_molecules" class="md-nav__link">
    <span class="md-ellipsis">
      iterate_molecules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qcmanybody.ManyBodyCalculator.analyze" class="md-nav__link">
    <span class="md-ellipsis">
      analyze
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG" class="md-nav__link">
    <span class="md-ellipsis">
      ManyBodyComputerQCNG
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ManyBodyComputerQCNG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.input_data" class="md-nav__link">
    <span class="md-ellipsis">
      input_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.bsse_type" class="md-nav__link">
    <span class="md-ellipsis">
      bsse_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.molecule" class="md-nav__link">
    <span class="md-ellipsis">
      molecule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.driver" class="md-nav__link">
    <span class="md-ellipsis">
      driver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.embedding_charges" class="md-nav__link">
    <span class="md-ellipsis">
      embedding_charges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.return_total_data" class="md-nav__link">
    <span class="md-ellipsis">
      return_total_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.levels" class="md-nav__link">
    <span class="md-ellipsis">
      levels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.max_nbody" class="md-nav__link">
    <span class="md-ellipsis">
      max_nbody
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.supersystem_ie_only" class="md-nav__link">
    <span class="md-ellipsis">
      supersystem_ie_only
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.task_list" class="md-nav__link">
    <span class="md-ellipsis">
      task_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.qcmb_calculator" class="md-nav__link">
    <span class="md-ellipsis">
      qcmb_calculator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.nfragments" class="md-nav__link">
    <span class="md-ellipsis">
      nfragments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.nbodies_per_mc_level" class="md-nav__link">
    <span class="md-ellipsis">
      nbodies_per_mc_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.Config" class="md-nav__link">
    <span class="md-ellipsis">
      Config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_bsse_type" class="md-nav__link">
    <span class="md-ellipsis">
      set_bsse_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_embedding_charges" class="md-nav__link">
    <span class="md-ellipsis">
      set_embedding_charges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_return_total_data" class="md-nav__link">
    <span class="md-ellipsis">
      set_return_total_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_levels" class="md-nav__link">
    <span class="md-ellipsis">
      set_levels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_max_nbody" class="md-nav__link">
    <span class="md-ellipsis">
      set_max_nbody
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_supersystem_ie_only" class="md-nav__link">
    <span class="md-ellipsis">
      set_supersystem_ie_only
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.from_manybodyinput" class="md-nav__link">
    <span class="md-ellipsis">
      from_manybodyinput
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.plan" class="md-nav__link">
    <span class="md-ellipsis">
      plan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.compute" class="md-nav__link">
    <span class="md-ellipsis">
      compute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.get_results" class="md-nav__link">
    <span class="md-ellipsis">
      get_results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#qcmanybody.ManyBodyCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      ManyBodyCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qcmanybody.ManyBodyCalculator.format_calc_plan" class="md-nav__link">
    <span class="md-ellipsis">
      format_calc_plan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qcmanybody.ManyBodyCalculator.iterate_molecules" class="md-nav__link">
    <span class="md-ellipsis">
      iterate_molecules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qcmanybody.ManyBodyCalculator.analyze" class="md-nav__link">
    <span class="md-ellipsis">
      analyze
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG" class="md-nav__link">
    <span class="md-ellipsis">
      ManyBodyComputerQCNG
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ManyBodyComputerQCNG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.input_data" class="md-nav__link">
    <span class="md-ellipsis">
      input_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.bsse_type" class="md-nav__link">
    <span class="md-ellipsis">
      bsse_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.molecule" class="md-nav__link">
    <span class="md-ellipsis">
      molecule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.driver" class="md-nav__link">
    <span class="md-ellipsis">
      driver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.embedding_charges" class="md-nav__link">
    <span class="md-ellipsis">
      embedding_charges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.return_total_data" class="md-nav__link">
    <span class="md-ellipsis">
      return_total_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.levels" class="md-nav__link">
    <span class="md-ellipsis">
      levels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.max_nbody" class="md-nav__link">
    <span class="md-ellipsis">
      max_nbody
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.supersystem_ie_only" class="md-nav__link">
    <span class="md-ellipsis">
      supersystem_ie_only
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.task_list" class="md-nav__link">
    <span class="md-ellipsis">
      task_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.qcmb_calculator" class="md-nav__link">
    <span class="md-ellipsis">
      qcmb_calculator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.nfragments" class="md-nav__link">
    <span class="md-ellipsis">
      nfragments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.nbodies_per_mc_level" class="md-nav__link">
    <span class="md-ellipsis">
      nbodies_per_mc_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.Config" class="md-nav__link">
    <span class="md-ellipsis">
      Config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_bsse_type" class="md-nav__link">
    <span class="md-ellipsis">
      set_bsse_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_embedding_charges" class="md-nav__link">
    <span class="md-ellipsis">
      set_embedding_charges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_return_total_data" class="md-nav__link">
    <span class="md-ellipsis">
      set_return_total_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_levels" class="md-nav__link">
    <span class="md-ellipsis">
      set_levels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_max_nbody" class="md-nav__link">
    <span class="md-ellipsis">
      set_max_nbody
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_supersystem_ie_only" class="md-nav__link">
    <span class="md-ellipsis">
      set_supersystem_ie_only
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.from_manybodyinput" class="md-nav__link">
    <span class="md-ellipsis">
      from_manybodyinput
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.plan" class="md-nav__link">
    <span class="md-ellipsis">
      plan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.compute" class="md-nav__link">
    <span class="md-ellipsis">
      compute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcmanybody.qcng_computer.ManyBodyComputerQCNG.get_results" class="md-nav__link">
    <span class="md-ellipsis">
      get_results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>API Documentation</h1>

<div class="doc doc-object doc-class">



<a id="qcmanybody.ManyBodyCalculator"></a>
  <div class="doc doc-contents first">


                <details class="quote">
                  <summary>Source code in <code>qcmanybody/manybody.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">molecule</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">,</span>
    <span class="n">bsse_type</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">BsseEnum</span><span class="p">],</span>
    <span class="n">levels</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;supersystem&quot;</span><span class="p">]],</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">return_total_data</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">supersystem_ie_only</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">embedding_charges</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
<span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">embedding_charges</span> <span class="o">=</span> <span class="n">embedding_charges</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">molecule</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bsse_type</span> <span class="o">=</span> <span class="p">[</span><span class="n">BsseEnum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bsse_type</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">return_total_data</span> <span class="o">=</span> <span class="n">return_total_data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">supersystem_ie_only</span> <span class="o">=</span> <span class="n">supersystem_ie_only</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nfragments</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule</span><span class="o">.</span><span class="n">fragments</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span>

    <span class="c1"># Levels without supersystem</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">levels_no_ss</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">levels</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;supersystem&quot;</span><span class="p">}</span>

    <span class="c1"># Just a set of all the modelchems</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mc_levels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">max_nbody</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels_no_ss</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bsse_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No BSSE correction specified&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">BsseEnum</span><span class="o">.</span><span class="n">vmfc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsse_type</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># For single-modelchem VMFC, NOCP &amp; sometimes CP are produced for free</span>
        <span class="k">if</span> <span class="n">BsseEnum</span><span class="o">.</span><span class="n">nocp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsse_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bsse_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BsseEnum</span><span class="o">.</span><span class="n">nocp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">BsseEnum</span><span class="o">.</span><span class="n">cp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsse_type</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_nbody</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfragments</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bsse_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BsseEnum</span><span class="o">.</span><span class="n">cp</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">return_bsse_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsse_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1">###############################</span>
    <span class="c1"># Build nbodies_per_mc_level</span>
    <span class="c1"># TODO - use Lori&#39;s code</span>
    <span class="c1"># TODO - dict to list of lists to handle non-contiguous levels</span>
    <span class="c1"># TODO multilevel and supersystem_ie_only=T not allowed together</span>
    <span class="c1"># TODO supersystem in levels is not to be trusted -- nfrag only and skips levels</span>
    <span class="n">max_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels_no_ss</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels_no_ss</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Levels must be contiguous from 1 to </span><span class="si">{</span><span class="n">max_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">nbodies_per_mc_level</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">mc_level</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">mc_level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_levels</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels_no_ss</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbodies_per_mc_level</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">nbodies_per_mc_level</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbodies_per_mc_level</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Supersystem is always at the end</span>
    <span class="k">if</span> <span class="s2">&quot;supersystem&quot;</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">:</span>
        <span class="n">ss_mc</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="s2">&quot;supersystem&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbodies_per_mc_level</span><span class="p">[</span><span class="n">ss_mc</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;supersystem&quot;</span><span class="p">)</span>

    <span class="c1"># To be built on the fly</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mc_compute_dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">fragments</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">symbols</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;QCManyBody: non-contiguous fragments could be implemented but aren&#39;t at present&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Build size and slices dictionaries. Assumes fragments are contiguous</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fragment_size_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fragment_slice_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">iat</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ifr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfragments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">nat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">fragments</span><span class="p">[</span><span class="n">ifr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fragment_size_dict</span><span class="p">[</span><span class="n">ifr</span><span class="p">]</span> <span class="o">=</span> <span class="n">nat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fragment_slice_dict</span><span class="p">[</span><span class="n">ifr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">iat</span><span class="p">,</span> <span class="n">iat</span> <span class="o">+</span> <span class="n">nat</span><span class="p">)</span>
        <span class="n">iat</span> <span class="o">+=</span> <span class="n">nat</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="qcmanybody.ManyBodyCalculator.format_calc_plan" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">format_calc_plan</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">format_calc_plan</span><span class="p">(</span><span class="n">sset</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">]]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Formulate per-modelchem and per-body job count data and summary text.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>sset</code></td>
          <td>
                <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Among {"all", "nocp", "cp", "vmfc_compute"}, which data structure to return.</p>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>info</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A text summary with per- model chemistry and per- n-body-level job counts.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td>
                <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Data structure with outer key mc-label, inner key 1-indexed n-body, value job count.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>qcmanybody/manybody.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_calc_plan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Formulate per-modelchem and per-body job count data and summary text.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sset</span>
<span class="sd">        Among {&quot;all&quot;, &quot;nocp&quot;, &quot;cp&quot;, &quot;vmfc_compute&quot;}, which data structure to return.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    info</span>
<span class="sd">        A text summary with per- model chemistry and per- n-body-level job counts.</span>
<span class="sd">    Dict[str, Dict[int, int]]</span>
<span class="sd">        Data structure with outer key mc-label, inner key 1-indexed n-body, value job count.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Rearrange compute_list from key nb having values (species) to compute all of that nb</span>
    <span class="c1">#   to key nb having values counting that nb.</span>
    <span class="n">compute_list_count</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">mc</span><span class="p">,</span> <span class="n">compute_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">compute_list_count</span><span class="p">[</span><span class="n">mc</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">compute_dict</span><span class="p">:</span>  <span class="c1"># all, nocp, cp, vmfc</span>
            <span class="n">all_calcs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">compute_dict</span><span class="p">[</span><span class="n">sub</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">compute_list_count</span><span class="p">[</span><span class="n">mc</span><span class="p">][</span><span class="n">sub</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">frag</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">frag</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">all_calcs</span><span class="p">])</span>

    <span class="n">info</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">mc</span><span class="p">,</span> <span class="n">counter</span> <span class="ow">in</span> <span class="n">compute_list_count</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">all_counter</span> <span class="o">=</span> <span class="n">counter</span><span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">]</span>
        <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Model chemistry </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">mc</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> (???):    </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">all_counter</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">nb</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_counter</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">other_counts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">counter</span><span class="p">[</span><span class="n">sub</span><span class="p">][</span><span class="n">nb</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;nocp&quot;</span><span class="p">,</span> <span class="s2">&quot;cp&quot;</span><span class="p">,</span> <span class="s2">&quot;vmfc_compute&quot;</span><span class="p">]]</span>
            <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        Number of </span><span class="si">{</span><span class="n">nb</span><span class="si">}</span><span class="s2">-body computations: </span><span class="si">{</span><span class="n">count</span><span class="si">:</span><span class="s2">6</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other_counts</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">info</span><span class="p">,</span> <span class="p">{</span><span class="n">mc</span><span class="p">:</span> <span class="n">dsset</span><span class="p">[</span><span class="n">sset</span><span class="p">]</span> <span class="k">for</span> <span class="n">mc</span><span class="p">,</span> <span class="n">dsset</span> <span class="ow">in</span> <span class="n">compute_list_count</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="qcmanybody.ManyBodyCalculator.iterate_molecules" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">iterate_molecules</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">iterate_molecules</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Iterable" href="https://docs.python.org/3/library/typing.html#typing.Iterable">Iterable</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="qcelemental.models.Molecule" href="https://molssi.github.io/QCElemental/api/qcelemental.models.Molecule.html#qcelemental.models.Molecule">Molecule</a></span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Iterate over all the molecules needed for the computation.</p>
<p>Yields model chemistry, label, and molecule.</p>

          <details class="quote">
            <summary>Source code in <code>qcmanybody/manybody.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">iterate_molecules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Iterate over all the molecules needed for the computation.</span>

<span class="sd">    Yields model chemistry, label, and molecule.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">done_molecules</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">mc</span><span class="p">,</span> <span class="n">compute_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># TODO - this is a bit of a hack. Lots of duplication when reaching higher nbody</span>
        <span class="k">for</span> <span class="n">compute_list</span> <span class="ow">in</span> <span class="n">compute_dict</span><span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">real_atoms</span><span class="p">,</span> <span class="n">basis_atoms</span> <span class="ow">in</span> <span class="n">compute_list</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">labeler</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">real_atoms</span><span class="p">,</span> <span class="n">basis_atoms</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">done_molecules</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">ghost_atoms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">basis_atoms</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">real_atoms</span><span class="p">))</span>

                <span class="c1"># Shift to zero-indexing</span>
                <span class="n">real_atoms_0</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">real_atoms</span><span class="p">]</span>
                <span class="n">ghost_atoms_0</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ghost_atoms</span><span class="p">]</span>
                <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">get_fragment</span><span class="p">(</span><span class="n">real_atoms_0</span><span class="p">,</span> <span class="n">ghost_atoms_0</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">group_fragments</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">mol</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fix_com&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;fix_orientation&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_charges</span><span class="p">:</span>
                    <span class="n">embedding_frags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfragments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">basis_atoms</span><span class="p">))</span>
                    <span class="n">charges</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">ifr</span> <span class="ow">in</span> <span class="n">embedding_frags</span><span class="p">:</span>
                        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">get_fragment</span><span class="p">(</span><span class="n">ifr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                        <span class="n">charges</span><span class="o">.</span><span class="n">extend</span><span class="p">([[</span><span class="n">chg</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_charges</span><span class="p">[</span><span class="n">ifr</span><span class="p">])])</span>
                    <span class="n">mol</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;embedding_charges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">charges</span>

                <span class="n">done_molecules</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">mc</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">mol</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="qcmanybody.ManyBodyCalculator.analyze" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">analyze</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">analyze</span><span class="p">(</span><span class="n">component_results</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></span><span class="p">]]])</span>
</code></pre></div>

  <div class="doc doc-contents ">
  



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>component_results</code></td>
          <td>
                <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Nested dictionary with results from all individual molecular system
calculations, including all subsystem/basis combinations, all model
chemistries, and all properties (e.g., e/g/h).</p>
<p>For example, the below is the format for a nocp gradient run on a
helium dimer with 1-body at CCSD and 2-body at MP2. The outer string
key can be generated with the <code>qcmanybody.utils.labeler</code> function.
The inner string key is any property; QCManyBody presently knows how
to process energy/gradient/Hessian.</p>
<p>{'["ccsd", [1], [1]]': {'energy': -2.87, 'gradient': array([[0., 0., 0.]])},
 '["ccsd", [2], [2]]': {'energy': -2.87, 'gradient': array([[0., 0., 0.]])},
 '["mp2", [1], [1]]': {'energy': -2.86, 'gradient': array([[0., 0., 0.]])},
 '["mp2", [2], [2]]': {'energy': -2.86, 'gradient': array([[0., 0., 0.]])},
 '["mp2", [1, 2], [1, 2]]': {'energy': -5.73, 'gradient': array([[ 0., 0., 0.0053], [ 0., 0., -0.0053]])},
}</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  
</details>
          <details class="quote">
            <summary>Source code in <code>qcmanybody/manybody.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span></pre></div></td><td class="code"><div><pre><span></span><code>    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">component_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        component_results</span>
<span class="sd">            Nested dictionary with results from all individual molecular system</span>
<span class="sd">            calculations, including all subsystem/basis combinations, all model</span>
<span class="sd">            chemistries, and all properties (e.g., e/g/h).</span>

<span class="sd">            For example, the below is the format for a nocp gradient run on a</span>
<span class="sd">            helium dimer with 1-body at CCSD and 2-body at MP2. The outer string</span>
<span class="sd">            key can be generated with the ``qcmanybody.utils.labeler`` function.</span>
<span class="sd">            The inner string key is any property; QCManyBody presently knows how</span>
<span class="sd">            to process energy/gradient/Hessian.</span>

<span class="sd">            {&#39;[&quot;ccsd&quot;, [1], [1]]&#39;: {&#39;energy&#39;: -2.87, &#39;gradient&#39;: array([[0., 0., 0.]])},</span>
<span class="sd">             &#39;[&quot;ccsd&quot;, [2], [2]]&#39;: {&#39;energy&#39;: -2.87, &#39;gradient&#39;: array([[0., 0., 0.]])},</span>
<span class="sd">             &#39;[&quot;mp2&quot;, [1], [1]]&#39;: {&#39;energy&#39;: -2.86, &#39;gradient&#39;: array([[0., 0., 0.]])},</span>
<span class="sd">             &#39;[&quot;mp2&quot;, [2], [2]]&#39;: {&#39;energy&#39;: -2.86, &#39;gradient&#39;: array([[0., 0., 0.]])},</span>
<span class="sd">             &#39;[&quot;mp2&quot;, [1, 2], [1, 2]]&#39;: {&#39;energy&#39;: -5.73, &#39;gradient&#39;: array([[ 0., 0., 0.0053], [ 0., 0., -0.0053]])},</span>
<span class="sd">            }</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># All properties that were passed to us</span>
        <span class="c1"># * seed with &quot;energy&quot; so free/no-op jobs can process</span>
        <span class="n">available_properties</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">property_data</span> <span class="ow">in</span> <span class="n">component_results</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">available_properties</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">property_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># reorganize to component_results_inv[property][label] = 1.23</span>
        <span class="n">component_results_inv</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">available_properties</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">cluster_label</span><span class="p">,</span> <span class="n">property_data</span> <span class="ow">in</span> <span class="n">component_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">property_label</span><span class="p">,</span> <span class="n">property_value</span> <span class="ow">in</span> <span class="n">property_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">component_results_inv</span><span class="p">[</span><span class="n">property_label</span><span class="p">][</span><span class="n">cluster_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">property_value</span>

        <span class="c1"># Remove any missing data</span>
        <span class="n">component_results_inv</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">component_results_inv</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">component_results_inv</span><span class="p">:</span>
            <span class="c1"># Note B: Rarely, &quot;no results&quot; is expected, like for CP-only,</span>
            <span class="c1">#   rtd=False, and max_nbody=1. We&#39;ll add a dummy entry so</span>
            <span class="c1">#   processing can continue.</span>
            <span class="n">component_results_inv</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;[&quot;dummy&quot;, [1000], [1000]]&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>

        <span class="c1"># Actually analyze</span>
        <span class="n">is_embedded</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_charges</span><span class="p">)</span>
        <span class="n">component_properties</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="n">all_results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">nbody_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="c1">#        all_results[&quot;energy_body_dict&quot;] = {&quot;cp&quot;: {1: 0.0}}</span>

        <span class="k">for</span> <span class="n">property_label</span><span class="p">,</span> <span class="n">property_results</span> <span class="ow">in</span> <span class="n">component_results_inv</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Expand gradient and hessian</span>
            <span class="k">if</span> <span class="n">property_label</span> <span class="o">==</span> <span class="s2">&quot;gradient&quot;</span><span class="p">:</span>
                <span class="n">property_results</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">resize_gradient</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">delabeler</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">property_results</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="k">if</span> <span class="n">property_label</span> <span class="o">==</span> <span class="s2">&quot;hessian&quot;</span><span class="p">:</span>
                <span class="n">property_results</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">resize_hessian</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">delabeler</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">property_results</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze</span><span class="p">(</span><span class="n">property_label</span><span class="p">,</span> <span class="n">property_results</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">property_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">component_properties</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;calcinfo_natom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
                <span class="n">component_properties</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;return_</span><span class="si">{</span><span class="n">property_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">all_results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsse_type</span><span class="p">:</span>
            <span class="n">stdout</span> <span class="o">+=</span> <span class="n">print_nbody_energy</span><span class="p">(</span>
                <span class="n">all_results</span><span class="p">[</span><span class="s2">&quot;energy_body_dict&quot;</span><span class="p">][</span><span class="n">bt</span><span class="p">],</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bt</span><span class="o">.</span><span class="n">formal</span><span class="p">()</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">bt</span><span class="o">.</span><span class="n">abbr</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nfragments</span><span class="p">,</span>
                <span class="n">is_embedded</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">supersystem_ie_only</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_nbody</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_supersystem</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">property_label</span> <span class="ow">in</span> <span class="n">available_properties</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsse_type</span><span class="p">:</span>
                <span class="n">nbody_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">collect_vars</span><span class="p">(</span>
                        <span class="n">bt</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                        <span class="n">property_label</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                        <span class="n">all_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">property_label</span><span class="si">}</span><span class="s2">_body_dict&quot;</span><span class="p">][</span><span class="n">bt</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_nbody</span><span class="p">,</span>
                        <span class="n">is_embedded</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">supersystem_ie_only</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">has_supersystem</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="n">all_results</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nbody_dict</span>
        <span class="n">all_results</span><span class="p">[</span><span class="s2">&quot;component_properties&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">component_properties</span>

        <span class="c1"># Make dictionary with &quot;1cp&quot;, &quot;2cp&quot;, etc</span>
        <span class="n">ebd</span> <span class="o">=</span> <span class="n">all_results</span><span class="p">[</span><span class="s2">&quot;energy_body_dict&quot;</span><span class="p">]</span>
        <span class="n">all_results</span><span class="p">[</span><span class="s2">&quot;energy_body_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">bt</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">ebd</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ebd</span><span class="p">[</span><span class="n">bt</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">all_results</span><span class="p">[</span><span class="s2">&quot;stdout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stdout</span>

        <span class="k">return</span> <span class="n">all_results</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">qcmanybody.qcng_computer.ManyBodyComputerQCNG</span>


</h2>


  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><span title="qcmanybody.qcng_computer.BaseComputerQCNG">BaseComputerQCNG</span></code></p>



  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.input_data" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">input_data</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">input_data</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="qcmanybody.models.ManyBodyInput" href="../qcschema/#qcmanybody.models.ManyBodyInput">ManyBodyInput</a></span> <span class="o">=</span> <span class="n"><span title="pydantic.Field">Field</span></span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Input schema containing the relevant settings for performing the many body expansion. This is entirely redundant with the piecemeal assembly of this Computer class and is only stored to be available for error handling and exact reconstruction of ManyBodyResult.&#39;</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.bsse_type" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">bsse_type</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">bsse_type</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="qcmanybody.models.BsseEnum" href="../qcschema/#qcmanybody.models.BsseEnum">BsseEnum</a></span><span class="p">]</span> <span class="o">=</span> <span class="n"><span title="pydantic.Field">Field</span></span><span class="p">([</span><span class="n"><span title="qcmanybody.models.BsseEnum.cp">cp</span></span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="n"><span title="field_info.description">description</span></span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.molecule" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">molecule</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">molecule</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="qcelemental.models.Molecule" href="https://molssi.github.io/QCElemental/api/qcelemental.models.Molecule.html#qcelemental.models.Molecule">Molecule</a></span> <span class="o">=</span> <span class="n"><span title="pydantic.Field">Field</span></span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Target molecule for many body expansion (MBE) or interaction energy (IE) analysis. Fragmentation should already be defined in `fragments` and related fields.&#39;</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.driver" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">driver</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">driver</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="qcelemental.models.DriverEnum" href="https://molssi.github.io/QCElemental/api/qcelemental.models.DriverEnum.html#qcelemental.models.DriverEnum">DriverEnum</a></span> <span class="o">=</span> <span class="n"><span title="pydantic.Field">Field</span></span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The computation driver; i.e., energy, gradient, hessian. In case of ambiguity (e.g., MBE gradient through finite difference energies or MBE energy through composite method), this field refers to the *target* derivative, not any *means* specification.&#39;</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.embedding_charges" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">embedding_charges</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">embedding_charges</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="n"><span title="pydantic.Field">Field</span></span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Atom-centered point charges to be used to speed up nbody-level convergence. Charges are placed on molecule fragments whose basis sets are not included in the computation. (An implication is that charges aren&#39;t invoked for bsse_type=cp.) Keys: 1-based index of fragment. Values: list of atom charges for that fragment.&quot;</span><span class="p">,</span> <span class="n">json_schema_extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;shape&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nfr&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;varies: nat in ifr&gt;&#39;</span><span class="p">]})</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.return_total_data" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">return_total_data</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">return_total_data</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span><span class="p">]</span> <span class="o">=</span> <span class="n"><span title="pydantic.Field">Field</span></span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n"><span title="field_info.description">description</span></span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.levels" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">levels</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">levels</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Literal" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span><span class="s1">&#39;supersystem&#39;</span><span class="p">]],</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">]]</span> <span class="o">=</span> <span class="n"><span title="pydantic.Field">Field</span></span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n"><span title="field_info.description">description</span></span> <span class="o">+</span> <span class="s2">&quot;Examples above are processed in the ManyBodyComputer, and once processed, only the values should be used. The keys turn into nbodies_per_mc_level, as notated below. * {1: &#39;ccsd(t)&#39;, 2: &#39;mp2&#39;, &#39;supersystem&#39;: &#39;scf&#39;} -&gt; nbodies_per_mc_level=[[1], [2], [&#39;supersystem&#39;]] * {2: &#39;ccsd(t)/cc-pvdz&#39;, 3: &#39;mp2&#39;} -&gt; nbodies_per_mc_level=[[1, 2], [3]] &quot;</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.max_nbody" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">max_nbody</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">max_nbody</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">]</span> <span class="o">=</span> <span class="n"><span title="pydantic.Field">Field</span></span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n"><span title="field_info.description">description</span></span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.supersystem_ie_only" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">supersystem_ie_only</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">supersystem_ie_only</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span><span class="p">]</span> <span class="o">=</span> <span class="n"><span title="pydantic.Field">Field</span></span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">validate_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n"><span title="field_info.description">description</span></span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.task_list" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">task_list</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">task_list</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.qcmb_calculator" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">qcmb_calculator</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">qcmb_calculator</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span> <span class="o">=</span> <span class="n"><span title="pydantic.Field">Field</span></span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Low-level interface&#39;</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.nfragments" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">nfragments</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">nfragments</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.nbodies_per_mc_level" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">nbodies_per_mc_level</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">nbodies_per_mc_level</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Literal" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span><span class="s1">&#39;supersystem&#39;</span><span class="p">]]]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>


<div class="doc doc-object doc-class">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.Config" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">Config</span>


</h3>


  <div class="doc doc-contents ">



  

  <div class="doc doc-children">











  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_bsse_type" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">set_bsse_type</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_bsse_type</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="qcmanybody.models.BsseEnum" href="../qcschema/#qcmanybody.models.BsseEnum">BsseEnum</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>qcmanybody/qcng_computer.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;bsse_type&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">set_bsse_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BsseEnum</span><span class="p">]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>
    <span class="c1"># emulate ordered set</span>
    <span class="c1"># * bt.lower() as return (w/i `list(dict.fromkeys([bt.lower() ...`)</span>
    <span class="c1">#   works until aliases added to BsseEnum</span>
    <span class="c1"># * BsseEnum[bt].value as return works for good vals, but passing bad</span>
    <span class="c1">#   vals through as bt lets pydantic raise a clearer error message</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">([(</span><span class="n">BsseEnum</span><span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">bt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">BsseEnum</span><span class="o">.</span><span class="n">__members__</span> <span class="k">else</span> <span class="n">bt</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_embedding_charges" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">set_embedding_charges</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_embedding_charges</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>qcmanybody/qcng_computer.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;embedding_charges&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="c1"># v2: def set_embedding_charges(cls, v: Any, info: FieldValidationInfo) -&gt; Dict[int, List[float]]:</span>
<span class="k">def</span> <span class="nf">set_embedding_charges</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span> <span class="c1"># -&gt; Dict[int, List[float]]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hit embedding_charges validator with </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">nfr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;molecule&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fragments</span><span class="p">)</span>
    <span class="c1"># v2: if len(v) != info.data[&quot;nfragments&quot;]:</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nfr</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;embedding_charges dict should have entries for each 1-indexed fragment (</span><span class="si">{</span><span class="n">nfr</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... setting embedding_charges=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_return_total_data" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">set_return_total_data</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_return_total_data</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span><span class="p">],</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>qcmanybody/qcng_computer.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;return_total_data&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="c1"># v2: def set_return_total_data(cls, v: Optional[bool], info: FieldValidationInfo) -&gt; bool:</span>
<span class="k">def</span> <span class="nf">set_return_total_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hit return_total_data validator with </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rtd</span> <span class="o">=</span> <span class="n">v</span>
    <span class="c1"># v2: elif info.data[&quot;driver&quot;] in [&quot;gradient&quot;, &quot;hessian&quot;]:</span>
    <span class="k">elif</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;driver&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="s2">&quot;hessian&quot;</span><span class="p">]:</span>
        <span class="n">rtd</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rtd</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># v2: if info.data.get(&quot;embedding_charges&quot;, False) and rtd is False:</span>
    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;embedding_charges&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rtd</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot return interaction data when using embedding scheme.&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... setting rtd=</span><span class="si">{</span><span class="n">rtd</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rtd</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_levels" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">set_levels</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_levels</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Literal" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span><span class="s1">&#39;supersystem&#39;</span><span class="p">]],</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>qcmanybody/qcng_computer.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;levels&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="c1"># v2: def set_levels(cls, v: Any, info: FieldValidationInfo) -&gt; Dict[Union[int, Literal[&quot;supersystem&quot;]], str]:</span>
<span class="k">def</span> <span class="nf">set_levels</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;supersystem&quot;</span><span class="p">]],</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hit levels validator with </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>
        <span class="c1"># TODO levels = {plan.max_nbody: method}</span>
        <span class="c1">#v = {info.data[&quot;nfragments&quot;]: &quot;???method???&quot;}</span>
        <span class="c1">#v = {len(info.data[&quot;molecule&quot;].fragments): &quot;???method???&quot;}</span>
        <span class="c1"># v2: v = {len(info.data[&quot;molecule&quot;].fragments): &quot;(auto)&quot;}</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">{</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;molecule&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fragments</span><span class="p">):</span> <span class="s2">&quot;(auto)&quot;</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># rearrange bodies in order with supersystem last lest body count fail in organization loop below</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;supersystem&quot;</span> <span class="k">else</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... setting levels=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_max_nbody" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">set_max_nbody</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_max_nbody</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>qcmanybody/qcng_computer.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;max_nbody&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="c1"># v2: def set_max_nbody(cls, v: Any, info: FieldValidationInfo) -&gt; int:</span>
<span class="k">def</span> <span class="nf">set_max_nbody</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hit max_nbody validator with </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="c1"># v2: levels_max_nbody = max(nb for nb in info.data[&quot;levels&quot;] if nb != &quot;supersystem&quot;)</span>
    <span class="c1"># v2: nfr = len(info.data[&quot;molecule&quot;].fragments)</span>
    <span class="n">levels_max_nbody</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nb</span> <span class="k">for</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;levels&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">nb</span> <span class="o">!=</span> <span class="s2">&quot;supersystem&quot;</span><span class="p">)</span>
    <span class="n">nfr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;molecule&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fragments</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">levels_max_nbody</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">nfr</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1">#ALT if v == -1:</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">levels_max_nbody</span>
    <span class="k">elif</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">nfr</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_nbody=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> should be between 1 and </span><span class="si">{</span><span class="n">nfr</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">levels_max_nbody</span><span class="p">:</span>
        <span class="c1">#raise ValueError(f&quot;levels={levels_max_nbody} contradicts user max_nbody={v}.&quot;)</span>
        <span class="c1"># TODO reconsider logic. move this from levels to here?</span>
        <span class="c1"># v2: info.data[&quot;levels&quot;] = {v: &quot;(auto)&quot;}</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;levels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="s2">&quot;(auto)&quot;</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
        <span class="c1"># TODO once was           return min(v, nfragments)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... setting max_nbody=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.set_supersystem_ie_only" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">set_supersystem_ie_only</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_supersystem_ie_only</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span><span class="p">],</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>qcmanybody/qcng_computer.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;supersystem_ie_only&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="c1"># v2: def set_supersystem_ie_only(cls, v: Optional[bool], info: FieldValidationInfo) -&gt; bool:</span>
<span class="k">def</span> <span class="nf">set_supersystem_ie_only</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hit supersystem_ie_only validator with </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">sio</span> <span class="o">=</span> <span class="n">v</span>
    <span class="c1"># v2: _nfr = len(info.data[&quot;molecule&quot;].fragments)</span>
    <span class="n">_nfr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;molecule&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fragments</span><span class="p">)</span>

    <span class="c1"># v2: _max_nbody = info.data[&quot;max_nbody&quot;]</span>
    <span class="c1"># get(..., None) b/c in v1, all fields processed even if max_nbody previously failed</span>
    <span class="n">_max_nbody</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_nbody&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sio</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_max_nbody</span> <span class="o">!=</span> <span class="n">_nfr</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot skip intermediate n-body jobs when max_nbody=</span><span class="si">{</span><span class="n">_max_nbody</span><span class="si">}</span><span class="s2"> != nfragments=</span><span class="si">{</span><span class="n">_nfr</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">sio</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;vmfc&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;bsse_type&quot;</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot skip intermediate n-body jobs when VMFC in bsse_type=</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;bsse_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Use CP instead.&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... setting </span><span class="si">{</span><span class="n">sio</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sio</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.from_manybodyinput" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">from_manybodyinput</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">from_manybodyinput</span><span class="p">(</span><span class="n">input_model</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="qcmanybody.models.ManyBodyInput" href="../qcschema/#qcmanybody.models.ManyBodyInput">ManyBodyInput</a></span><span class="p">,</span> <span class="n">build_tasks</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>qcmanybody/qcng_computer.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_manybodyinput</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">input_model</span><span class="p">:</span> <span class="n">ManyBodyInput</span><span class="p">,</span> <span class="n">build_tasks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>

    <span class="n">computer_model</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">molecule</span><span class="o">=</span><span class="n">input_model</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span>
        <span class="n">driver</span><span class="o">=</span><span class="n">input_model</span><span class="o">.</span><span class="n">specification</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span>
        <span class="c1"># v2: **input_model.specification.keywords.model_dump(exclude_unset=True),</span>
        <span class="o">**</span><span class="n">input_model</span><span class="o">.</span><span class="n">specification</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">input_data</span><span class="o">=</span><span class="n">input_model</span><span class="p">,</span>  <span class="c1"># storage, to reconstitute ManyBodyResult</span>
    <span class="p">)</span>
    <span class="n">nb_per_mc</span> <span class="o">=</span> <span class="n">computer_model</span><span class="o">.</span><span class="n">nbodies_per_mc_level</span>

    <span class="c1"># print(&quot;\n&lt;&lt;&lt;  (ZZ 1) QCEngine harness ManyBodyComputerQCNG.from_qcschema_ben  &gt;&gt;&gt;&quot;)</span>
    <span class="c1"># v2: pprint.pprint(computer_model.model_dump(), width=200)</span>
    <span class="c1"># pprint.pprint(computer_model.dict(), width=200)</span>
    <span class="c1"># print(f&quot;nbodies_per_mc_level={nb_per_mc}&quot;)</span>

    <span class="n">comp_levels</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">mc_level_idx</span><span class="p">,</span> <span class="n">mtd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">computer_model</span><span class="o">.</span><span class="n">levels</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="k">for</span> <span class="n">lvl1</span> <span class="ow">in</span> <span class="n">nb_per_mc</span><span class="p">[</span><span class="n">mc_level_idx</span><span class="p">]:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;supersystem&quot;</span> <span class="k">if</span> <span class="n">lvl1</span> <span class="o">==</span> <span class="s2">&quot;supersystem&quot;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">lvl1</span><span class="p">)</span>
            <span class="n">comp_levels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtd</span>

    <span class="n">specifications</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">mtd</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">computer_model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">specification</span><span class="o">.</span><span class="n">specification</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
        <span class="n">specifications</span><span class="p">[</span><span class="n">mtd</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">specifications</span><span class="p">[</span><span class="n">mtd</span><span class="p">][</span><span class="s2">&quot;program&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;program&quot;</span><span class="p">)</span>
        <span class="n">specifications</span><span class="p">[</span><span class="n">mtd</span><span class="p">][</span><span class="s2">&quot;specification&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span>
        <span class="n">specifications</span><span class="p">[</span><span class="n">mtd</span><span class="p">][</span><span class="s2">&quot;specification&quot;</span><span class="p">][</span><span class="s2">&quot;driver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">computer_model</span><span class="o">.</span><span class="n">driver</span>  <span class="c1"># overrides atomic driver with mb driver</span>
        <span class="n">specifications</span><span class="p">[</span><span class="n">mtd</span><span class="p">][</span><span class="s2">&quot;specification&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;schema_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">computer_model</span><span class="o">.</span><span class="n">qcmb_calculator</span> <span class="o">=</span> <span class="n">ManyBodyCalculator</span><span class="p">(</span>
        <span class="n">computer_model</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span>
        <span class="n">computer_model</span><span class="o">.</span><span class="n">bsse_type</span><span class="p">,</span>
        <span class="n">comp_levels</span><span class="p">,</span>
        <span class="n">computer_model</span><span class="o">.</span><span class="n">return_total_data</span><span class="p">,</span>
        <span class="n">computer_model</span><span class="o">.</span><span class="n">supersystem_ie_only</span><span class="p">,</span>
        <span class="n">computer_model</span><span class="o">.</span><span class="n">embedding_charges</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">build_tasks</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">computer_model</span>

    <span class="n">component_properties</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">component_results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">chem</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">imol</span> <span class="ow">in</span> <span class="n">computer_model</span><span class="o">.</span><span class="n">qcmb_calculator</span><span class="o">.</span><span class="n">iterate_molecules</span><span class="p">():</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">AtomicInput</span><span class="p">(</span><span class="n">molecule</span><span class="o">=</span><span class="n">imol</span><span class="p">,</span> <span class="o">**</span><span class="n">specifications</span><span class="p">[</span><span class="n">chem</span><span class="p">][</span><span class="s2">&quot;specification&quot;</span><span class="p">])</span>
        <span class="c1"># inp = AtomicInput(molecule=imol, **specifications[chem][&quot;specification&quot;], extras={&quot;psiapi&quot;: True})  # faster for p4</span>

        <span class="k">if</span> <span class="n">imol</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;embedding_charges&quot;</span><span class="p">):</span>  <span class="c1"># or test on self.embedding_charges ?</span>
            <span class="k">if</span> <span class="n">specifications</span><span class="p">[</span><span class="n">chem</span><span class="p">][</span><span class="s2">&quot;program&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;psi4&quot;</span><span class="p">:</span>
                <span class="n">charges</span> <span class="o">=</span> <span class="n">imol</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;embedding_charges&quot;</span><span class="p">]</span>
                <span class="n">fkw</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;function_kwargs&quot;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">fkw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;external_potentials&quot;</span><span class="p">:</span> <span class="n">charges</span><span class="p">})</span>
                <span class="n">inp</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s2">&quot;function_kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fkw</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Don&#39;t know how to handle external charges in </span><span class="si">{</span><span class="n">specifications</span><span class="p">[</span><span class="n">chem</span><span class="p">][</span><span class="s1">&#39;program&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">real</span><span class="p">,</span> <span class="n">bas</span> <span class="o">=</span> <span class="n">delabeler</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">qcng</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">specifications</span><span class="p">[</span><span class="n">chem</span><span class="p">][</span><span class="s2">&quot;program&quot;</span><span class="p">])</span>
        <span class="n">component_results</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">error_message</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Calculation did not succeed! Error:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">error_message</span><span class="p">)</span>

        <span class="c1"># pull out stuff</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="s2">&quot;hessian&quot;</span><span class="p">}</span>

        <span class="n">component_properties</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">props</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">properties</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;return_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">properties</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;return_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># print(f&quot;  {label} {p}: {v}&quot;)</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">component_properties</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="c1"># print(&quot;\n&lt;&lt;&lt;  (ZZ 2) QCEngine harness ManyBodyComputerQCNG.from_qcschema_ben component_properties  &gt;&gt;&gt;&quot;)</span>
    <span class="c1"># pprint.pprint(component_properties, width=200)</span>

    <span class="n">analyze_back</span> <span class="o">=</span> <span class="n">computer_model</span><span class="o">.</span><span class="n">qcmb_calculator</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">component_properties</span><span class="p">)</span>
    <span class="n">analyze_back</span><span class="p">[</span><span class="s2">&quot;nbody_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">component_properties</span><span class="p">)</span>
    <span class="c1"># print(&quot;\n&lt;&lt;&lt;  (ZZ 3) QCEngine harness ManyBodyComputerQCNG.from_qcschema_ben analyze_back  &gt;&gt;&gt;&quot;)</span>
    <span class="c1"># pprint.pprint(analyze_back, width=200)</span>

    <span class="k">return</span> <span class="n">computer_model</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">external_results</span><span class="o">=</span><span class="n">analyze_back</span><span class="p">,</span> <span class="n">component_results</span><span class="o">=</span><span class="n">component_results</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.plan" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">plan</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">plan</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>qcmanybody/qcng_computer.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># uncalled function</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">plan</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.compute" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">compute</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">compute</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="qcportal.FractalClient">FractalClient</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Run quantum chemistry.</p>
<p>NOTE: client logic removed (compared to psi4.driver.ManyBodyComputer)</p>

          <details class="quote">
            <summary>Source code in <code>qcmanybody/qcng_computer.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;qcportal.FractalClient&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run quantum chemistry.</span>

<span class="sd">    NOTE: client logic removed (compared to psi4.driver.ManyBodyComputer)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="qcmanybody.qcng_computer.ManyBodyComputerQCNG.get_results" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_results</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_results</span><span class="p">(</span><span class="n">external_results</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></span><span class="p">,</span> <span class="n">component_results</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="qcportal.FractalClient">FractalClient</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="qcmanybody.models.ManyBodyResult" href="../qcschema/#qcmanybody.models.ManyBodyResult">ManyBodyResult</a></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return results as ManyBody-flavored QCSchema.</p>

          <details class="quote">
            <summary>Source code in <code>qcmanybody/qcng_computer.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span></pre></div></td><td class="code"><div><pre><span></span><code>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">external_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">component_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;qcportal.FractalClient&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ManyBodyResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return results as ManyBody-flavored QCSchema.&quot;&quot;&quot;</span>

        <span class="n">ret_energy</span> <span class="o">=</span> <span class="n">external_results</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ret_energy&quot;</span><span class="p">)</span>
        <span class="n">ret_ptype</span> <span class="o">=</span> <span class="n">ret_energy</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">==</span> <span class="s2">&quot;energy&quot;</span> <span class="k">else</span> <span class="n">external_results</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ret_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ret_gradient</span> <span class="o">=</span> <span class="n">external_results</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ret_gradient&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">nbody_number</span> <span class="o">=</span> <span class="n">external_results</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;nbody_number&quot;</span><span class="p">)</span>
        <span class="n">component_properties</span> <span class="o">=</span> <span class="n">external_results</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;component_properties&quot;</span><span class="p">)</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="n">external_results</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;stdout&quot;</span><span class="p">)</span>

        <span class="c1"># load QCVariables</span>
        <span class="n">qcvars</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;NUCLEAR REPULSION ENERGY&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">nuclear_repulsion_energy</span><span class="p">(),</span>
            <span class="s1">&#39;NBODY NUMBER&#39;</span><span class="p">:</span> <span class="n">nbody_number</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;calcinfo_nmc&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbodies_per_mc_level</span><span class="p">),</span>
            <span class="s2">&quot;calcinfo_nfr&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfragments</span><span class="p">,</span>  <span class="c1"># or len(self.molecule.fragments)</span>
            <span class="s2">&quot;calcinfo_natom&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">symbols</span><span class="p">),</span>
            <span class="s2">&quot;calcinfo_nmbe&quot;</span><span class="p">:</span> <span class="n">nbody_number</span><span class="p">,</span>
            <span class="s2">&quot;nuclear_repulsion_energy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">nuclear_repulsion_energy</span><span class="p">(),</span>
            <span class="s2">&quot;return_energy&quot;</span><span class="p">:</span> <span class="n">ret_energy</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">external_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;results&quot;</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="s2">&quot;nbody&quot;</span>
            <span class="n">qcvars</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="n">qcvars</span><span class="p">[</span><span class="s1">&#39;CURRENT ENERGY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret_energy</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">==</span> <span class="s1">&#39;gradient&#39;</span><span class="p">:</span>
            <span class="n">qcvars</span><span class="p">[</span><span class="s1">&#39;CURRENT GRADIENT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret_ptype</span>
            <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;return_gradient&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret_ptype</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">==</span> <span class="s1">&#39;hessian&#39;</span><span class="p">:</span>
            <span class="n">qcvars</span><span class="p">[</span><span class="s1">&#39;CURRENT GRADIENT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret_gradient</span>
            <span class="n">qcvars</span><span class="p">[</span><span class="s1">&#39;CURRENT HESSIAN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret_ptype</span>
            <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;return_gradient&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret_gradient</span>
            <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;return_hessian&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret_ptype</span>

<span class="c1">#        build_out(qcvars)</span>
        <span class="n">atprop</span> <span class="o">=</span> <span class="n">build_manybodyproperties</span><span class="p">(</span><span class="n">qcvars</span><span class="p">[</span><span class="s2">&quot;nbody&quot;</span><span class="p">])</span>
        <span class="c1"># print(&quot;ATPROP&quot;)</span>
        <span class="c1"># v2: pp.pprint(atprop.model_dump())</span>
        <span class="c1"># pp.pprint(atprop.dict())</span>

<span class="c1">#        output_data = {</span>
<span class="c1">#            &quot;schema_version&quot;: 1,</span>
<span class="c1">#            &quot;molecule&quot;: gamessmol,  # overwrites with outfile Cartesians in case fix_*=F</span>
<span class="c1">#            &quot;extras&quot;: {**input_model.extras},</span>
<span class="c1">#            &quot;native_files&quot;: {k: v for k, v in outfiles.items() if v is not None},</span>
<span class="c1">#            &quot;properties&quot;: atprop,</span>

<span class="c1">#####</span>
<span class="c1">#        nbody_model = self.get_results(client=client)</span>
<span class="c1">#        ret = nbody_model.return_result</span>
<span class="c1">#</span>
<span class="c1">#        wfn = core.Wavefunction.build(self.molecule, &quot;def2-svp&quot;, quiet=True)</span>
<span class="c1">#</span>
<span class="c1">#        # TODO all besides nbody may be better candidates for extras than qcvars. energy/gradient/hessian_body_dict in particular are too simple for qcvars (e.g., &quot;2&quot;)</span>

        <span class="c1"># print(&quot;QCVARS PRESCREEN&quot;)</span>
        <span class="c1"># pp.pprint(qcvars)</span>

        <span class="k">for</span> <span class="n">qcv</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">qcvars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">qcvars</span><span class="p">[</span><span class="n">qcv</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="c1"># v2: component_results = self.model_dump()[&#39;task_list&#39;]  # TODO when/where include the indiv outputs</span>
        <span class="c1">#?component_results = self.dict()[&#39;task_list&#39;]  # TODO when/where include the indiv outputs</span>
<span class="c1">#        for k, val in component_results.items():</span>
<span class="c1">#            val[&#39;molecule&#39;] = val[&#39;molecule&#39;].to_schema(dtype=2)</span>

        <span class="c1"># print(&quot;QCVARS&quot;)</span>
        <span class="c1"># pp.pprint(qcvars)</span>

        <span class="n">nbody_model</span> <span class="o">=</span> <span class="n">ManyBodyResult</span><span class="p">(</span>
            <span class="o">**</span><span class="p">{</span>
                <span class="s1">&#39;input_data&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span><span class="p">,</span>
                <span class="c1">#&#39;molecule&#39;: self.molecule,</span>
                <span class="c1"># v2: &#39;properties&#39;: {**atprop.model_dump(), **properties},</span>
                <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="o">**</span><span class="n">atprop</span><span class="o">.</span><span class="n">dict</span><span class="p">(),</span> <span class="o">**</span><span class="n">properties</span><span class="p">},</span>
                <span class="s1">&#39;component_properties&#39;</span><span class="p">:</span> <span class="n">component_properties</span><span class="p">,</span>
                <span class="s2">&quot;component_results&quot;</span><span class="p">:</span> <span class="n">component_results</span><span class="p">,</span>
                <span class="s1">&#39;provenance&#39;</span><span class="p">:</span> <span class="n">provenance_stamp</span><span class="p">(</span><span class="vm">__name__</span><span class="p">),</span>
                <span class="s1">&#39;extras&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;qcvars&#39;</span><span class="p">:</span> <span class="n">qcvars</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s1">&#39;return_result&#39;</span><span class="p">:</span> <span class="n">ret_ptype</span><span class="p">,</span>
                <span class="s2">&quot;stdout&quot;</span><span class="p">:</span> <span class="n">stdout</span><span class="p">,</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">})</span>

<span class="c1">#        logger.debug(&#39;\nNBODY QCSchema:\n&#39; + pp.pformat(nbody_model.model_dump()))</span>

        <span class="k">return</span> <span class="n">nbody_model</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><p><strong>ManyBodyComputerQCNG</strong></p>
<table>
<thead>
<tr>
<th>key</th>
<th>type</th>
<th>required</th>
<th>description</th>
<th>default</th>
</tr>
</thead>
<tbody>
<tr>
<td>input_data</td>
<td><class 'qcmanybody.models.manybody_input_pydv1.ManyBodyInput'></td>
<td>True</td>
<td>Input schema containing the relevant settings for performing the many body expansion. This is entirely redundant with the piecemeal assembly of this Computer class and is only stored to be available for error handling and exact reconstruction of ManyBodyResult.</td>
<td>None</td>
</tr>
<tr>
<td>bsse_type</td>
<td><enum 'BsseEnum'></td>
<td>False</td>
<td>Requested BSSE treatments. First in list determines which interaction or total energy/gradient/Hessian returned.</td>
<td>[<BsseEnum.cp: 'cp'>]</td>
</tr>
<tr>
<td>molecule</td>
<td><class 'qcelemental.models.molecule.Molecule'></td>
<td>True</td>
<td>Target molecule for many body expansion (MBE) or interaction energy (IE) analysis. Fragmentation should already be defined in <code>fragments</code> and related fields.</td>
<td>None</td>
</tr>
<tr>
<td>driver</td>
<td><enum 'DriverEnum'></td>
<td>True</td>
<td>The computation driver; i.e., energy, gradient, hessian. In case of ambiguity (e.g., MBE gradient through finite difference energies or MBE energy through composite method), this field refers to the <em>target</em> derivative, not any <em>means</em> specification.</td>
<td>None</td>
</tr>
<tr>
<td>embedding_charges</td>
<td>typing.List[float]</td>
<td>False</td>
<td>Atom-centered point charges to be used to speed up nbody-level convergence. Charges are placed on molecule fragments whose basis sets are not included in the computation. (An implication is that charges aren't invoked for bsse_type=cp.) Keys: 1-based index of fragment. Values: list of atom charges for that fragment.</td>
<td>None</td>
</tr>
<tr>
<td>return_total_data</td>
<td><class 'bool'></td>
<td>False</td>
<td>When True, returns the total data (energy/gradient/Hessian) of the system, otherwise returns interaction data. Default is False for energies, True for gradients and Hessians. Note that the calculation of counterpoise corrected total energies implies the calculation of the energies of monomers in the monomer basis, hence specifying <code>return_total_data = True</code> may carry out more computations than <code>return_total_data = False</code>. For gradients and Hessians, <code>return_total_data = False</code> is rarely useful.</td>
<td>None</td>
</tr>
<tr>
<td>levels</td>
<td><class 'str'></td>
<td>False</td>
<td>Dictionary of different levels of theory for different levels of expansion. Note that the primary method_string is not used when this keyword is given. <code>supersystem</code> computes all higher order n-body effects up to the number of fragments; this higher-order correction uses the nocp basis, regardless of bsse_type. A method fills in for any lower unlisted nbody levels. Note that if both this and max_nbody are provided, they must be consistent. Examples: SUPERSYSTEM definition suspect* {1: 'ccsd(t)', 2: 'mp2', 'supersystem': 'scf'} * {2: 'ccsd(t)/cc-pvdz', 3: 'mp2'} * Now invalid: {1: 2, 2: 'ccsd(t)/cc-pvdz', 3: 'mp2'} Examples above are processed in the ManyBodyComputer, and once processed, only the values should be used. The keys turn into nbodies_per_mc_level, as notated below. * {1: 'ccsd(t)', 2: 'mp2', 'supersystem': 'scf'} -&gt; nbodies_per_mc_level=[[1], [2], ['supersystem']] * {2: 'ccsd(t)/cc-pvdz', 3: 'mp2'} -&gt; nbodies_per_mc_level=[[1, 2], [3]]</td>
<td>None</td>
</tr>
<tr>
<td>max_nbody</td>
<td><class 'int'></td>
<td>False</td>
<td>Maximum number of bodies to include in the many-body treatment. Possible: max_nbody &lt;= nfragments. Default: max_nbody = nfragments.</td>
<td>None</td>
</tr>
<tr>
<td>supersystem_ie_only</td>
<td><class 'bool'></td>
<td>False</td>
<td>Target the supersystem total/interaction energy (IE) data over the many-body expansion (MBE) analysis, thereby omitting intermediate-body calculations. When False (default), compute each n-body level in the MBE up through <code>max_nbody</code>. When True (only allowed for <code>max_nbody = nfragments</code>), only compute enough for the overall interaction/total energy: max_nbody-body and 1-body. When True, properties <code>INTERACTION {driver} THROUGH {max_nbody}-BODY</code> will always be available; <code>TOTAL {driver} THROUGH {max_nbody}-BODY</code> will be available depending on <code>return_total_data</code>; and <code>{max_nbody}-BODY CONTRIBUTION TO {driver}</code> won't be available (except for dimers). This keyword produces no savings for a two-fragment molecule. But for the interaction energy of a three-fragment molecule, for example, 2-body subsystems can be skipped with <code>supersystem_ie_only=True</code> Do not use with <code>vmfc</code> in <code>bsse_type</code>as it cannot produce savings.</td>
<td>False</td>
</tr>
<tr>
<td>task_list</td>
<td>typing.Any</td>
<td>False</td>
<td></td>
<td>{}</td>
</tr>
<tr>
<td>qcmb_calculator</td>
<td>typing.Any</td>
<td>False</td>
<td>Low-level interface</td>
<td>None</td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 QCManyBody Developers
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5cfa9459.min.js"></script>
      
    
  </body>
</html>